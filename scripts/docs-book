#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"
BOOK_DIR="$PROJECT_DIR/book"

OPEN_WEB=false

# Parse arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        -w|--web)
            OPEN_WEB=true
            shift
            ;;
        *)
            echo "Unknown option: $1"
            echo "Usage: $0 [-w|--web]"
            exit 1
            ;;
    esac
done

cd "$PROJECT_DIR"

echo "Building mdBook documentation..."
mdbook build

echo "Documentation built successfully in $BOOK_DIR"

if [ "$OPEN_WEB" = true ]; then
    INDEX_PATH="$BOOK_DIR/index.html"
    if [ -f "$INDEX_PATH" ]; then
        echo "Opening documentation in browser..."
        open "$INDEX_PATH"
    else
        echo "Error: $INDEX_PATH not found"
        exit 1
    fi
fi
